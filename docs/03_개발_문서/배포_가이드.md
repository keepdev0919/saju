# 배포 가이드 (Deployment Guide)

## 📋 개요

천명록 서비스의 프로덕션 배포를 위한 완전한 가이드입니다.
업계 표준 스택을 기반으로 초기 런칭부터 확장 단계까지의 배포 전략을 다룹니다.

---

## 🎯 추천 배포 스택 (업계 표준)

### 초기 런칭 구성 (0~10만명)

```
프론트엔드: Vercel (무료)
백엔드: Railway ($5/월)
데이터베이스: PlanetScale (무료) 또는 Railway 내장 MySQL
```

**이유:**
- ✅ 업계 표준 스택 (대부분의 스타트업이 사용)
- ✅ 설정 간단, 빠른 배포
- ✅ 합리적 비용 ($5/월로 시작)
- ✅ 검증된 안정성
- ✅ 커뮤니티 지원 풍부

---

## 💰 비용 분석

### 월별 비용 예상

| 사용자 수 | 프론트 (Vercel) | 백엔드 (Railway) | DB | 총 비용 |
|----------|----------------|-----------------|-----|---------|
| **100명** | $0 (무료) | $5 | $0 | **$5/월** |
| **1,000명** | $0 (무료) | $5 | $0 | **$5/월** |
| **10,000명** | $0 (무료) | $5~10 | $0 | **$5~10/월** |
| **100,000명** | $20 (Pro) | $20 | $0 | **$40/월** |
| **1,000,000명** | $20 (Pro) | $50~100 | $29 | **$99~149/월** |

### 수익 대비 비용

```
사용자 1,000명, 전환율 10% = 100명 결제
→ 수익: 100명 × 29,000원 = 290만원
→ 비용: $5 (약 7,000원)
→ 순이익: 289만원 ✅

사용자 10,000명, 전환율 10% = 1,000명 결제
→ 수익: 1,000명 × 29,000원 = 2,900만원
→ 비용: $10 (약 14,000원)
→ 순이익: 2,898만원 ✅
```

**결론**: 수익 대비 비용은 매우 낮습니다.

---

## 🚀 단계별 배포 가이드

### 1단계: Vercel 배포 (프론트엔드)

#### 1.1 Vercel 계정 생성
1. [vercel.com](https://vercel.com) 접속
2. GitHub 계정으로 로그인
3. 무료 플랜 선택

#### 1.2 프로젝트 연결
```bash
# Vercel CLI 설치
npm i -g vercel

# 프로젝트 루트에서 배포
vercel

# 또는 GitHub 연동하여 자동 배포
# Vercel Dashboard → Add New Project → GitHub 연동
```

#### 1.3 환경 변수 설정
Vercel Dashboard → Project Settings → Environment Variables

필수 변수:
```
VITE_API_URL=https://your-railway-app.railway.app
VITE_PORTONE_IMP_KEY=your-portone-key
```

#### 1.4 빌드 설정
`vercel.json` (선택사항):
```json
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "framework": "vite"
}
```

---

### 2단계: Railway 배포 (백엔드)

#### 2.1 Railway 계정 생성
1. [railway.app](https://railway.app) 접속
2. GitHub 계정으로 로그인
3. Hobby 플랜 선택 ($5/월)

#### 2.2 프로젝트 배포
1. Railway Dashboard → New Project
2. Deploy from GitHub repo 선택
3. `backend` 폴더 선택
4. 자동 배포 시작

#### 2.3 환경 변수 설정
Railway Dashboard → Variables 탭

필수 변수:
```env
NODE_ENV=production
PORT=3000

# 데이터베이스
DB_HOST=your-db-host
DB_USER=your-db-user
DB_PASSWORD=your-db-password
DB_NAME=saju_db

# 포트원 결제
PORTONE_IMP_KEY=your-portone-key
PORTONE_IMP_SECRET=your-portone-secret

# 카카오 알림톡
KAKAO_ALIMTALK_API_KEY=your-kakao-key
KAKAO_ALIMTALK_SENDER_KEY=your-sender-key

# OpenAI
OPENAI_API_KEY=your-openai-key

# JWT
JWT_SECRET=your-jwt-secret
```

#### 2.4 데이터베이스 설정

**옵션 A: Railway 내장 MySQL (추천)**
1. Railway Dashboard → New → Database → MySQL
2. 자동으로 환경 변수 생성됨
3. 스키마 실행:
```bash
# Railway MySQL에 접속하여
mysql -h $DB_HOST -u $DB_USER -p $DB_NAME < backend/database/schema.sql
```

**옵션 B: PlanetScale (서버리스)**
1. [planetscale.com](https://planetscale.com) 계정 생성
2. 무료 플랜으로 데이터베이스 생성
3. 연결 정보를 Railway 환경 변수에 입력

#### 2.5 도메인 설정
Railway Dashboard → Settings → Domains
- 자동 생성된 도메인 사용: `your-app.railway.app`
- 또는 커스텀 도메인 연결

---

### 3단계: 데이터베이스 마이그레이션

#### 3.1 스키마 실행
```bash
# Railway MySQL 접속
mysql -h $DB_HOST -u $DB_USER -p $DB_NAME

# 스키마 실행
source backend/database/schema.sql
```

#### 3.2 초기 데이터 설정 (선택)
```bash
# 테스트 데이터 (개발용)
mysql -h $DB_HOST -u $DB_USER -p $DB_NAME < backend/database/test_data.sql

# 관리자 계정 생성
cd backend
npm run create-admin
```

---

## 🔧 환경 변수 체크리스트

### 프론트엔드 (Vercel)
- [ ] `VITE_API_URL` - 백엔드 API URL
- [ ] `VITE_PORTONE_IMP_KEY` - 포트원 결제 키
- [ ] `VITE_PAYMENT_AMOUNT_BASIC` - 기본 결제 금액
- [ ] `VITE_PAYMENT_AMOUNT_PDF` - PDF 결제 금액

### 백엔드 (Railway)
- [ ] `DB_HOST`, `DB_USER`, `DB_PASSWORD`, `DB_NAME`
- [ ] `PORTONE_IMP_KEY`, `PORTONE_IMP_SECRET`
- [ ] `KAKAO_ALIMTALK_API_KEY`, `KAKAO_ALIMTALK_SENDER_KEY`
- [ ] `OPENAI_API_KEY`
- [ ] `JWT_SECRET`

---

## 📊 모니터링 및 관리

### Vercel 모니터링
1. Vercel Dashboard → Analytics
   - 대역폭 사용량 확인
   - 빌드 시간 모니터링
   - 무료 한도 초과 시 알림 설정

### Railway 모니터링
1. Railway Dashboard → Metrics
   - CPU/메모리 사용량
   - 네트워크 트래픽
   - 로그 확인

2. 비용 알림 설정
   - Settings → Usage → Set Budget Alert
   - 예: $10 초과 시 이메일 알림

### 데이터베이스 모니터링
- PlanetScale: Dashboard에서 쿼리 성능 확인
- Railway MySQL: Railway Metrics에서 확인

---

## 🔒 보안 체크리스트

### 배포 전 필수 확인
- [ ] 모든 환경 변수 설정 완료
- [ ] `.env` 파일이 Git에 커밋되지 않았는지 확인
- [ ] 데이터베이스 비밀번호 강력하게 설정
- [ ] CORS 설정 확인 (프로덕션 도메인만 허용)
- [ ] HTTPS 적용 확인 (자동 적용됨)

### 보안 모범 사례
- [ ] JWT Secret 강력하게 설정
- [ ] API Rate Limiting 적용 (선택)
- [ ] 정기적인 보안 업데이트
- [ ] 로그에 민감 정보 노출 방지

---

## 📈 확장 전략

### 단계별 플랜 업그레이드

#### 초기 단계 (0~10,000명)
```
Vercel: 무료 플랜
Railway: Hobby ($5/월)
PlanetScale: 무료 플랜
→ 총 $5/월
```

#### 성장 단계 (10,000~100,000명)
```
Vercel: Pro ($20/월) - 필요 시
Railway: Pro ($20/월)
PlanetScale: Scaler ($29/월) - 필요 시
→ 총 $20~69/월
```

#### 확장 단계 (100,000명+)
```
Vercel: Enterprise
Railway: Pro 또는 AWS ECS
PlanetScale: Scaler 또는 AWS RDS
→ 총 $100+/월
```

---

## 🚨 트러블슈팅

### 일반적인 문제

#### 1. 환경 변수 불일치
**증상**: API 호출 실패
**해결**: Vercel과 Railway의 환경 변수 일치 확인

#### 2. 데이터베이스 연결 실패
**증상**: 서버 시작 실패
**해결**: 
- Railway 환경 변수 확인
- 데이터베이스 접근 권한 확인
- 방화벽 설정 확인

#### 3. 빌드 실패
**증상**: Vercel 배포 실패
**해결**:
- `package.json` 의존성 확인
- 빌드 로그 확인
- Node.js 버전 확인

#### 4. CORS 오류
**증상**: 프론트엔드에서 API 호출 실패
**해결**:
- Railway 백엔드 CORS 설정 확인
- Vercel 도메인을 허용 목록에 추가

---

## 📝 배포 후 체크리스트

### 즉시 확인
- [ ] 프론트엔드 접속 확인
- [ ] API 엔드포인트 동작 확인
- [ ] 데이터베이스 연결 확인
- [ ] 결제 테스트 (테스트 모드)
- [ ] 알림톡 발송 테스트

### 1주일 후 확인
- [ ] 트래픽 모니터링
- [ ] 비용 확인
- [ ] 에러 로그 확인
- [ ] 성능 최적화 필요 여부 판단

---

## 🔄 CI/CD 자동화

### GitHub Actions (선택사항)

`.github/workflows/deploy.yml`:
```yaml
name: Deploy

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Deploy to Railway
        run: |
          # Railway CLI로 자동 배포
          # 또는 Railway GitHub 연동 사용
```

**참고**: Railway와 Vercel은 GitHub 연동 시 자동 배포됩니다.

---

## 🌐 Cloudflare 추가 (선택사항)

### 추가 시점
- 사용자 10만명+
- DDoS 공격 경험
- 해외 사용자 증가
- 보안 강화 필요

### 설정 방법
1. [cloudflare.com](https://cloudflare.com) 계정 생성
2. 도메인 추가
3. DNS 설정 (Vercel, Railway 도메인 연결)
4. SSL/TLS 자동 설정

**참고**: 초기 단계에서는 불필요합니다. Vercel이 이미 CDN을 제공합니다.

---

## 📚 참고 자료

### 공식 문서
- [Vercel Documentation](https://vercel.com/docs)
- [Railway Documentation](https://docs.railway.app)
- [PlanetScale Documentation](https://docs.planetscale.com)

### 유용한 링크
- [Vercel 가격 정책](https://vercel.com/pricing)
- [Railway 가격 정책](https://railway.app/pricing)
- [PlanetScale 가격 정책](https://planetscale.com/pricing)

---

## 💡 핵심 요약

### 추천 스택
```
✅ 프론트엔드: Vercel (무료)
✅ 백엔드: Railway ($5/월)
✅ 데이터베이스: PlanetScale (무료) 또는 Railway 내장
→ 총 $5/월로 시작!
```

### 성공 포인트
1. **단계적 접근**: 초기에는 최소 구성으로 시작
2. **비용 모니터링**: 주간 비용 확인 습관화
3. **자동 배포**: GitHub 연동으로 CI/CD 구축
4. **확장 준비**: 트래픽 증가 시 플랜 업그레이드

### 안심하세요
- ✅ 초기 비용은 매우 낮습니다 ($5/월)
- ✅ 트래픽 증가 시 단계적으로 확장 가능
- ✅ 수익 대비 비용은 매우 낮습니다
- ✅ 업계 표준 스택으로 검증된 안정성

---

**작성일**: 2024년 12월
**최종 업데이트**: 2024년 12월

