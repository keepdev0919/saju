# 🏛️ 천상 기록보관소 성능 최적화 및 기술 리포트

**문서 날짜:** 2025년 12월 19일
**대상:** 천상의 기록보관소 (Celestial Archive) 내 스크롤 및 인디케이터 반응성 개선

---

## 1. 문제 정의 (The Problem)
천상의 기록보관소 모달 내에서 60갑자 카드를 나열한 그리드 영역을 좌우로 스크롤할 때, 하단에 위치한 '스크롤 인디케이터(Scroll Indicator)'가 사용자의 조작보다 약 **0.5~1초 늦게 따라오는 현상(Lag)**이 발생함.

## 2. 근본 원인 분석 (Root Cause Analysis)

### A. 렌더링 오버헤드 (Rendering Bottleneck)
기존 코드에서는 60개의 각 카드에 대해 강력한 시각 효과가 중첩 적용되어 있었습니다.
- **이미지 블러 (Blur Filter):** `blur-[2px]`와 같은 필터는 브라우저가 매 프레임마다 픽셀을 흐림 처리해야 하는 초고사양 연산입니다. 60개의 레이어에 이 연산이 걸려 스크롤 시 GPU 점유율이 급증했습니다.
- **그레이스케일 (Grayscale Filter):** 실시간 색상 변환 연산이 스크롤 성능을 저하시켰습니다.
- **백드롭 블러 (Backdrop Blur):** 레이어 뒷부분을 실시간으로 굴절시키는 연산이 추가적인 부하를 주었습니다.

### B. React 리렌더링 (React Re-render Delay)
스크롤 이벤트를 React State(`scrollRatio`)로 관리함에 따라, 스크롤할 때마다 약 1,600줄 규모의 `SajuApp` 전체 컴포넌트가 다시 계산되고 다시 그려지는 과정을 거쳤습니다. 이는 JS 실행 스레드에 병목을 발생시켰습니다.

---

## 3. 해결 전략 및 적용 내용 (The Solution)

### Phase 1: 시각적 사양 최적화 (Visual Refine)
- **그리드 내 모든 Blur, Grayscale 필터 제거:** 연산량이 많은 필터 대신 `opacity` 조절과 배경색 명도 조절을 통해 고급스러운 분위기를 유지하며 성능을 확보했습니다.
- **Backdrop-blur 제거:** 시각적 차이는 미미하지만 성능 체감이 큰 백드롭 블러를 삭제했습니다.
- **상시 애니메이션 중단:** `animate-pulse` 등 불필요한 GPU 호출을 유발하는 애니메이션을 제거했습니다.

### Phase 2: 기술적 성능 최적화 (Deep Tech Optimization)
- **Direct DOM Manipulation:** React State를 거치지 않고 `useRef`를 통해 인디케이터의 DOM에 직접 접근하여 위치를 수정합니다. 이를 통해 컴포넌트 리렌더링 없이 즉각적인 반응이 가능해졌습니다.
- **requestAnimationFrame (rAF):** 브라우저의 화면 갱신 주기(60fps)에 맞춰 연산을 수행하여 부드러움을 극대화했습니다.
- **GPU 하드웨어 가속:** `translateX` 대신 `translate3d(x, 0, 0)`를 사용하여 GPU 레이어를 분리하고 최적화된 렌더링 파이프라인을 탔습니다.
- **will-change 선언:** 브라우저에게 해당 요소의 변화를 미리 예고하여 사전 최적화를 유도했습니다.

---

## 4. 최종 결과 (Outcome)
- **반응성:** 사용자의 스크롤 조작과 인디케이터의 움직임이 **1:1로 완전 동기화** (Zero-Latency).
- **시인성:** 카드의 배경 필터를 제거하는 대신 텍스트의 두께(`font-bold`)와 명도(`text-stone-300`)를 높여 조도가 낮은 다크 모드에서도 보석처럼 선명하게 보이도록 개선함.
- **안정성:** 대량의 콘텐츠(60개 카드) 노출 시에도 저사양 기기에서 안정적인 프레임을 유지함.

---
**기술 지원:** Antigravity Performance Optimization Team
