# 카카오 알림톡 연동 가이드

## 📋 개요

카카오 알림톡을 통한 결과 링크 발송 기능을 실제로 연동하기 위한 가이드입니다.

---

## 🔑 사전 준비 사항

### 1. 카카오 비즈니스 채널 등록

1. **카카오 비즈니스 채널 생성**
   - [카카오 비즈니스](https://business.kakao.com/) 접속
   - 카카오 계정으로 로그인
   - "비즈니스 채널 만들기" 클릭
   - 채널 정보 입력 (이름, 카테고리 등)

2. **비즈니스 인증**
   - 사업자 등록증 업로드
   - 담당자 정보 입력
   - 인증 완료 대기 (1-2일 소요)

### 2. 알림톡 템플릿 등록

1. **템플릿 작성**
   - 카카오 비즈니스 채널 관리 페이지 접속
   - "알림톡" → "템플릿 만들기" 클릭
   - 템플릿 내용 작성:
     ```
     [사주 풀이 결과 안내]
     
     #{user_name}님, 사주 풀이 결과가 준비되었습니다.
     
     아래 링크를 클릭하여 결과를 확인하세요.
     #{result_url}
     ```

2. **템플릿 변수 설정**
   - `#{user_name}`: 사용자 이름
   - `#{result_url}`: 결과 조회 링크

3. **템플릿 승인 대기**
   - 카카오 측 검수 진행 (1-2일 소요)
   - 승인 완료 후 템플릿 코드 발급

### 3. API 키 발급

1. **앱 등록**
   - [카카오 개발자 콘솔](https://developers.kakao.com/) 접속
   - "내 애플리케이션" → "애플리케이션 추가하기"
   - 앱 이름, 사업자명 입력

2. **알림톡 API 활성화**
   - 앱 설정 → "알림톡" 활성화
   - 비즈니스 채널 연결

3. **REST API 키 발급**
   - 앱 설정 → "앱 키" 확인
   - REST API 키 복사

4. **알림톡 발신 프로필 키 확인**
   - 카카오 비즈니스 채널 관리 페이지
   - "알림톡" → "발신 프로필" 확인
   - 발신 프로필 키 복사

---

## 🔧 환경 변수 설정

### backend/.env 파일에 추가

```env
# 카카오 알림톡 API 설정
KAKAO_ALIMTALK_API_KEY=your_rest_api_key_here
KAKAO_ALIMTALK_SENDER_KEY=your_sender_key_here
KAKAO_ALIMTALK_TEMPLATE_CODE=your_template_code_here
```

### 환경 변수 설명

- `KAKAO_ALIMTALK_API_KEY`: 카카오 개발자 콘솔에서 발급받은 REST API 키
- `KAKAO_ALIMTALK_SENDER_KEY`: 카카오 비즈니스 채널의 발신 프로필 키
- `KAKAO_ALIMTALK_TEMPLATE_CODE`: 승인받은 알림톡 템플릿 코드

---

## 📝 코드 수정 사항

### 1. 알림톡 API 엔드포인트 확인

카카오 알림톡 API는 두 가지 방식이 있습니다:

#### 방식 1: 친구톡 (기본 메시지)
- 엔드포인트: `https://kapi.kakao.com/v2/api/talk/messages/default/send`
- 친구 추가된 사용자에게만 발송 가능

#### 방식 2: 알림톡 (비즈니스 메시지) ⭐ **권장**
- 엔드포인트: `https://kapi.kakao.com/v1/alimtalk/messages/send`
- 친구 추가 없이 발송 가능
- 템플릿 기반 발송

### 2. 현재 코드 상태

현재 `backend/src/services/kakaoService.js`는 기본 메시지 API를 사용하고 있습니다.

**알림톡 API로 변경이 필요합니다.**

---

## 🚀 실제 연동 단계

### Step 1: 카카오 비즈니스 채널 등록
- [ ] 카카오 비즈니스 채널 생성
- [ ] 비즈니스 인증 완료
- [ ] 발신 프로필 키 확인

### Step 2: 알림톡 템플릿 등록
- [ ] 템플릿 작성 및 제출
- [ ] 템플릿 승인 완료
- [ ] 템플릿 코드 확인

### Step 3: API 키 발급
- [ ] 카카오 개발자 콘솔에서 앱 등록
- [ ] 알림톡 API 활성화
- [ ] REST API 키 발급

### Step 4: 환경 변수 설정
- [ ] `backend/.env`에 API 키 추가
- [ ] 환경 변수 확인

### Step 5: 코드 수정
- [ ] 알림톡 API 엔드포인트로 변경
- [ ] 템플릿 코드 적용
- [ ] 테스트 발송

---

## 📚 참고 자료

- [카카오 비즈니스 채널 가이드](https://business.kakao.com/info/service/channel)
- [카카오 알림톡 API 문서](https://developers.kakao.com/docs/latest/ko/kakaotalk-business/alimtalk)
- [카카오 개발자 콘솔](https://developers.kakao.com/)

---

## ⚠️ 주의사항

1. **비즈니스 인증 필요**: 실제 발송을 위해서는 사업자 등록이 필요합니다.
2. **템플릿 승인 대기**: 템플릿 등록 후 승인까지 1-2일 소요됩니다.
3. **테스트 발송**: 승인 전에는 테스트 발송이 불가능합니다.
4. **발송 비용**: 알림톡 발송 시 건당 비용이 발생합니다 (약 20원/건).

---

## 🔄 다음 단계

카카오 비즈니스 채널 등록 및 템플릿 승인이 완료되면, 코드 수정을 진행하겠습니다.

현재는 더미 모드로 동작하며, 환경 변수가 설정되면 자동으로 실제 API를 호출합니다.

