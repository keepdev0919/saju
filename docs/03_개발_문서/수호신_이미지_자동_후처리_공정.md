# 기술 작업 지시서: 수호신 이미지 자동 후처리 및 동적 각인 공정

## 1. 개요 (Overview)
본 문서는 60갑자 수호신 이미지 생성 완료 후, AI 에이전트(Antigravity 등)가 수행해야 할 **자동화된 이미지 후처리 작업**에 대한 상세 지시를 담고 있습니다. 추후 새로운 대화 세션에서 이 문서를 제시하여 작업을 바로 시작할 수 있습니다.

---

## 2. 작업 목적 (Objectives)
1. **보관소용 자산 생성**: 원본 이미지에 '천명록' 낙관을 합성하여 보안과 브랜딩이 강화된 도감용 이미지 생성.
2. **유료 결과용 각인 시스템**: 결제 유저의 성함을 이미지 특정 위치에 동적으로 합성하는 백엔드 로직 구현.

---

## 3. 원본 자산 준비 사양 (Input Requirements)
사용자(Creator)는 다음 사양에 맞춰 원본을 준비합니다.
- **파일명**: `갑자.png`, `을축.png` ... `계해.png` (총 60장)
- **규격**: 최소 1024x1024 px 이상 (권장 2:3 또는 3:4 비율)
- **보관 경로**: `/public/images/talisman/originals/` (임시)

---

## 4. [작업 A] 도감용 배치 워터마킹 (Batch Watermarking)

### 수행 방법
- **사용 기술**: Node.js `sharp` 라이브러리
- **합성 로직**:
    1. `/public/images/talisman/stamps/seal_red.png`를 마스터 워터마크로 사용.
    2. 모든 원본 이미지의 **중앙 하단** 또는 **우측 하단**에 특정 스케일(약 15~20%)로 합성.
    3. `Mix-blend-mode: multiply` 효과와 유사한 알파 채널 합성 적용.
- **출력 경로**: `/public/images/talisman/archive/`
- **파일 형식**: 용량 최적화된 WebP 또는 PNG

---

## 5. [작업 B] 유료용 동적 성함 각인 (Dynamic Engraving)

### 수행 방법
- **사용 기술**: `canvas` (Node-canvas) 또는 `sharp` (Composite text metadata)
- **각인 상세**:
    1. 유저가 입력한 성함(예: '김철수')을 이미지 내 '각인 영역'에 렌더링.
    2. **폰트**: 낙관과 어울리는 고풍스러운 '서예체' 또는 '전서체' 폰트 사용.
    3. **효과**: 잉크가 번진 듯한 효과 또는 금박 질감(필요시) 적용.
- **결과물**: 결제 확인 후 메모리상에서 생성하여 전송하거나 임시 보안 URL로 제공.

---

## 6. AI 에이전트에게 내릴 명령 (Prompt Example)
추후 새로운 세션 시작 시 아래와 같이 명령하십시오:

> "기록된 `docs/03_개발_문서/수호신_이미지_자동_후처리_공정.md` 파일을 참조해서 작업을 시작해줘. 지금 `/public/images/talisman/originals/` 폴더에 원본 이미지들이 준비됐어. `sharp` 라이브러리를 사용해서 도감용 워터마크 합본 작업을 진행하고 결과물을 `archive` 폴더에 생성해줘."

---
## 7. 기대 결과 (Expected Output)
- 포토샵 수작업 없이 60장의 고퀄리티 도감 자산 즉시 확보.
- 유저별로 커스터마이징된 '세상에 단 하나뿐인' 수호신 카드 생성 시스템 완성.
