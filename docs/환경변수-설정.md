# 환경 변수 설정 가이드

프로젝트 실행을 위한 환경 변수 설정 방법입니다.

## 📁 환경 변수 파일 위치

### 프론트엔드
- 파일: `.env` (프로젝트 루트)
- 예시 파일: `.env.example`

### 백엔드
- 파일: `backend/.env`
- 예시 파일: `backend/.env.example`

## 🚀 빠른 설정

### 1. 프론트엔드 환경 변수

프로젝트 루트에 `.env` 파일을 생성하세요:

```bash
# .env
VITE_API_BASE_URL=http://localhost:3000/api
VITE_PORTONE_IMP_KEY=imp12345678  # 포트원(아임포트) 가맹점 코드

# 결제 금액 설정 (테스트 모드: 100원, 프로덕션: 9900원)
VITE_PAYMENT_AMOUNT_BASIC=100  # 기본 사주 풀이 금액
VITE_PAYMENT_AMOUNT_PDF=100    # PDF 다운로드 금액
```

### 2. 백엔드 환경 변수

`backend` 폴더에 `.env` 파일을 생성하세요:

```bash
cd backend
cp .env.example .env
```

그리고 `.env` 파일을 열어서 필요한 값들을 입력하세요:

```env
# 서버 설정
PORT=3000
NODE_ENV=development
FRONTEND_URL=http://localhost:5173

# 데이터베이스 설정
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=saju_db

# 포트원 결제 설정 (테스트 모드)
PORTONE_IMP_KEY=your_portone_key
PORTONE_IMP_SECRET=your_portone_secret

# 카카오 알림톡 설정
KAKAO_ALIMTALK_API_KEY=your_kakao_key
KAKAO_ALIMTALK_SENDER_KEY=your_sender_key

# 사주 API 설정 (선택사항)
SAJU_API_KEY=your_saju_api_key
SAJU_API_URL=https://api.example.com/saju
```

## 📝 환경 변수 설명

### 프론트엔드

| 변수명 | 설명 | 기본값 |
|--------|------|--------|
| `VITE_API_BASE_URL` | 백엔드 API 기본 URL | `http://localhost:3000/api` |
| `VITE_PORTONE_IMP_KEY` | 포트원(아임포트) V1 API 고객사 식별코드 | `imp12345678` (테스트용) |
| `VITE_PAYMENT_AMOUNT_BASIC` | 기본 사주 풀이 결제 금액 (원) | `100` (테스트용) |
| `VITE_PAYMENT_AMOUNT_PDF` | PDF 다운로드 결제 금액 (원) | `100` (테스트용) |

**참고**: 
- 프론트엔드는 V1 API만 사용하므로 `store_id`나 `api_secret`은 필요 없습니다.
- 테스트 모드에서는 실제 결제가 발생하므로 금액을 낮게 설정하는 것을 권장합니다 (100원).
- 프로덕션 배포 시에는 실제 금액으로 변경하세요 (예: 9900원, 3000원).

### 백엔드

#### 서버 설정
- `PORT`: 서버 포트 번호 (기본값: 3000)
- `NODE_ENV`: 실행 환경 (`development` 또는 `production`)
- `FRONTEND_URL`: 프론트엔드 URL (CORS 설정용)

#### 데이터베이스 설정
- `DB_HOST`: MySQL 호스트 주소
- `DB_USER`: MySQL 사용자명
- `DB_PASSWORD`: MySQL 비밀번호
- `DB_NAME`: 데이터베이스 이름

#### 포트원 결제 설정 (V1 API)

**필수 환경 변수:**
- `PORTONE_IMP_KEY`: 포트원(아임포트) V1 API 고객사 식별코드 (예: `imp12345678`)
- `PORTONE_IMP_SECRET`: 포트원(아임포트) V1 API Secret

**참고:**
- 프론트엔드와 백엔드 모두 V1 API를 사용합니다
- 환경 변수가 없으면 더미 모드로 동작합니다 (개발/테스트용)

**테스트 모드 사용법:**
1. [포트원 대시보드](https://admin.portone.io/) 접속
2. "연동 정보" > "식별코드 ㆍ API Keys" 메뉴에서 V1 API 선택
3. "고객사 식별코드"와 "REST API Secret" 복사
4. 백엔드 `.env` 파일에 설정
5. 사업자 등록 없이도 테스트 가능

#### 카카오 알림톡 설정
- `KAKAO_ALIMTALK_API_KEY`: 카카오 REST API 키 (개발자 콘솔에서 발급)
- `KAKAO_ALIMTALK_SENDER_KEY`: 발신 프로필 키 (비즈니스 채널에서 확인)
- `KAKAO_ALIMTALK_TEMPLATE_CODE`: 알림톡 템플릿 코드 (승인받은 템플릿 코드)

**설정 방법:**
1. [카카오 비즈니스](https://business.kakao.com/) 접속하여 비즈니스 채널 등록
2. [카카오 개발자 콘솔](https://developers.kakao.com/)에서 앱 등록 및 REST API 키 발급
3. 알림톡 템플릿 등록 및 승인 대기 (1-2일 소요)
4. 승인 완료 후 템플릿 코드 확인
5. 자세한 내용은 `docs/카카오-알림톡-연동-가이드.md` 참고

**참고:**
- 설정하지 않으면 더미 모드로 동작합니다 (실제 발송 없음)
- 실제 발송을 위해서는 사업자 등록 및 비즈니스 인증이 필요합니다

#### 사주 API 설정 (선택사항)
- `SAJU_API_KEY`: 사주 API 키
- `SAJU_API_URL`: 사주 API URL

**참고:**
- 설정하지 않으면 더미 데이터로 동작합니다
- 실제 사주 API 연동 시 설정 필요

## 🔒 보안 주의사항

1. **`.env` 파일은 절대 Git에 커밋하지 마세요**
   - `.gitignore`에 이미 추가되어 있습니다
   - 실제 API 키가 노출되면 보안 문제가 발생할 수 있습니다

2. **프로덕션 환경**
   - 프로덕션 배포 시 환경 변수를 안전하게 관리하세요
   - Vercel, AWS 등 플랫폼의 환경 변수 설정 기능 사용

3. **API 키 관리**
   - 테스트용 키와 프로덕션용 키를 분리하세요
   - 키가 유출되면 즉시 재발급하세요

## ✅ 설정 확인

### 프론트엔드
```bash
npm run dev
```
브라우저 콘솔에서 API 호출이 정상적으로 이루어지는지 확인하세요.

### 백엔드
```bash
cd backend
npm run dev
```
서버가 정상적으로 시작되고 데이터베이스 연결이 성공하는지 확인하세요.

## 🐛 문제 해결

### 데이터베이스 연결 실패
- MySQL이 실행 중인지 확인
- 데이터베이스가 생성되었는지 확인 (`database/schema.sql` 실행)
- 사용자명, 비밀번호가 올바른지 확인

### API 호출 실패
- 백엔드 서버가 실행 중인지 확인
- `VITE_API_BASE_URL`이 올바른지 확인
- CORS 설정이 올바른지 확인

### 환경 변수가 적용되지 않음
- 프론트엔드: 서버를 재시작하세요 (Vite는 재시작 필요)
- 백엔드: `.env` 파일이 `backend` 폴더에 있는지 확인

